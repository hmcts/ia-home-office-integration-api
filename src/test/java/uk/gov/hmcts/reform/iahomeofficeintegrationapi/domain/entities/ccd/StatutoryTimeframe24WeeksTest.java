package uk.gov.hmcts.reform.iahomeofficeintegrationapi.domain.entities.ccd;

import org.junit.jupiter.api.Test;
import uk.gov.hmcts.reform.iahomeofficeintegrationapi.domain.entities.ccd.field.YesOrNo;
import java.util.ArrayList;
import java.util.List;
import uk.gov.hmcts.reform.iahomeofficeintegrationapi.domain.entities.ccd.field.IdValue;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.junit.jupiter.api.Assertions.assertFalse;

public class StatutoryTimeframe24WeeksTest {

    @Test
    void testEqualsAndHashCode() {
        List<IdValue<StatutoryTimeframe24WeeksHistory>> historyList1 = new ArrayList<>();
        historyList1.add(new IdValue<>("1", new StatutoryTimeframe24WeeksHistory(
            YesOrNo.YES,
            "Reason 1",
            "User 1",
            "2023-01-01T10:00:00"
        )));

        StatutoryTimeframe24Weeks timeframe1 = new StatutoryTimeframe24Weeks(
            YesOrNo.YES,
            historyList1
        );

        List<IdValue<StatutoryTimeframe24WeeksHistory>> historyList2 = new ArrayList<>();
        historyList2.add(new IdValue<>("1", new StatutoryTimeframe24WeeksHistory(
            YesOrNo.YES,
            "Reason 1",
            "User 1",
            "2023-01-01T10:00:00"
        )));

        StatutoryTimeframe24Weeks timeframe2 = new StatutoryTimeframe24Weeks(
            YesOrNo.YES,
            historyList2
        );

        List<IdValue<StatutoryTimeframe24WeeksHistory>> historyList3 = new ArrayList<>();
        historyList3.add(new IdValue<>("1", new StatutoryTimeframe24WeeksHistory(
            YesOrNo.NO,
            "Reason 2",
            "User 2",
            "2023-01-02T10:00:00"
        )));

        StatutoryTimeframe24Weeks timeframe3 = new StatutoryTimeframe24Weeks(
            YesOrNo.NO,
            historyList3
        );

        // Then
        assertEquals(timeframe1, timeframe2);
        assertEquals(timeframe1.hashCode(), timeframe2.hashCode());
        
        assertNotEquals(timeframe1, timeframe3);
        assertNotEquals(timeframe1.hashCode(), timeframe3.hashCode());
    }

    @Test
    void shouldCreateStatutoryTimeframe24WeeksWithValidData() {
        // Given
        YesOrNo status = YesOrNo.YES;
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = createHistory("1", YesOrNo.YES);

        // When
        StatutoryTimeframe24Weeks stf = new StatutoryTimeframe24Weeks(status, history);

        // Then
        assertNotNull(stf);
        assertEquals(YesOrNo.YES, stf.getCurrentStatusAutoGenerated());
        assertEquals(1, stf.getHistory().size());
    }

    @Test
    void shouldThrowNullPointerExceptionWhenStatusIsNull() {
        // Given
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = createHistory("1", YesOrNo.YES);

        // When & Then
        assertThrows(NullPointerException.class, () -> new StatutoryTimeframe24Weeks(null, history));
    }

    @Test
    void shouldThrowNullPointerExceptionWhenHistoryIsNull() {
        // When & Then
        assertThrows(NullPointerException.class, () -> new StatutoryTimeframe24Weeks(YesOrNo.YES, null));
    }

    @Test
    void shouldBeEqualWhenSameValues() {
        // Given
        YesOrNo status = YesOrNo.YES;
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = createHistory("1", YesOrNo.YES);

        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(status, history);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(status, history);

        // Then
        assertEquals(stf1, stf2);
        assertEquals(stf1.hashCode(), stf2.hashCode());
        assertTrue(stf1.equals(stf2));
        assertTrue(stf2.equals(stf1));
    }

    @Test
    void shouldNotBeEqualWhenDifferentStatus() {
        // Given
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = createHistory("1", YesOrNo.YES);

        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(YesOrNo.YES, history);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(YesOrNo.NO, history);

        // Then
        assertNotEquals(stf1, stf2);
        assertNotEquals(stf1.hashCode(), stf2.hashCode());
        assertFalse(stf1.equals(stf2));
    }

    @Test
    void shouldNotBeEqualWhenDifferentHistory() {
        // Given
        YesOrNo status = YesOrNo.YES;
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history1 = createHistory("1", YesOrNo.YES);
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history2 = createHistory("2", YesOrNo.NO);

        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(status, history1);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(status, history2);

        // Then
        assertNotEquals(stf1, stf2);
        assertFalse(stf1.equals(stf2));
    }

    @Test
    void shouldBeEqualToItself() {
        // Given
        StatutoryTimeframe24Weeks stf = new StatutoryTimeframe24Weeks(
            YesOrNo.YES,
            createHistory("1", YesOrNo.YES)
        );

        // Then
        assertEquals(stf, stf);
        assertEquals(stf.hashCode(), stf.hashCode());
        assertTrue(stf.equals(stf));
    }

    @Test
    void shouldNotBeEqualToNull() {
        // Given
        StatutoryTimeframe24Weeks stf = new StatutoryTimeframe24Weeks(
            YesOrNo.YES,
            createHistory("1", YesOrNo.YES)
        );

        // Then
        assertNotEquals(null, stf);
        assertFalse(stf.equals(null));
    }

    @Test
    void shouldNotBeEqualToDifferentType() {
        // Given
        StatutoryTimeframe24Weeks stf = new StatutoryTimeframe24Weeks(
            YesOrNo.YES,
            createHistory("1", YesOrNo.YES)
        );

        // Then
        assertNotEquals("different type", stf);
        assertFalse(stf.equals("different type"));
        assertFalse(stf.equals(new Object()));
    }

    @Test
    void shouldHaveConsistentToString() {
        // Given
        YesOrNo status = YesOrNo.YES;
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = createHistory("1", YesOrNo.YES);
        
        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(status, history);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(status, history);

        // Then
        assertNotNull(stf1.toString());
        assertEquals(stf1.toString(), stf2.toString());
    }

    @Test
    void shouldSatisfyEqualsTransitivity() {
        // Given
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = createHistory("1", YesOrNo.YES);
        
        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(YesOrNo.YES, history);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(YesOrNo.YES, history);
        StatutoryTimeframe24Weeks stf3 = new StatutoryTimeframe24Weeks(YesOrNo.YES, history);

        // Then - transitive property
        assertTrue(stf1.equals(stf2));
        assertTrue(stf2.equals(stf3));
        assertTrue(stf1.equals(stf3));
    }

    @Test
    void shouldHaveDifferentHashCodeWhenDifferentFields() {
        // Given
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history1 = createHistory("1", YesOrNo.YES);
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history2 = createHistory("2", YesOrNo.NO);
        
        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(YesOrNo.YES, history1);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(YesOrNo.NO, history2);

        // Then - different objects should likely have different hash codes
        assertNotEquals(stf1.hashCode(), stf2.hashCode());
    }

    @Test
    void shouldHandleEmptyHistoryList() {
        // Given
        List<IdValue<StatutoryTimeframe24WeeksHistory>> emptyHistory = new ArrayList<>();
        
        StatutoryTimeframe24Weeks stf1 = new StatutoryTimeframe24Weeks(YesOrNo.YES, emptyHistory);
        StatutoryTimeframe24Weeks stf2 = new StatutoryTimeframe24Weeks(YesOrNo.YES, emptyHistory);

        // Then
        assertEquals(stf1, stf2);
        assertEquals(stf1.hashCode(), stf2.hashCode());
    }

    private List<IdValue<StatutoryTimeframe24WeeksHistory>> createHistory(String id, YesOrNo status) {
        List<IdValue<StatutoryTimeframe24WeeksHistory>> history = new ArrayList<>();
        StatutoryTimeframe24WeeksHistory historyEntry = new StatutoryTimeframe24WeeksHistory(
            status,
            "Test reason",
            "Test user",
            "2024-01-01T12:00:00"
        );
        history.add(new IdValue<>(id, historyEntry));
        return history;
    }
}
